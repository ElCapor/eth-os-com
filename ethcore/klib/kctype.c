#include "klib/kctype.h"

/* Table grabbed from https://cppreference.com/
 *
 * fig. 1:
 * +----------------------------------------------------------------------+
 * |           ASCII           |       |    |    |    |    |    |    |    |
 * |---------------------------| Chars | cn | pr | sp | bl | gr | pn | an |
 * |   dec   |  hex  |   oct   |       |    |    |    |    |    |    |    |
 * |---------+-------+---------+-------+----+----+----+----+----+----+----|
 * |     0-8 |   0-8 |    0-10 |   cc1 |  + |  - |  - |  - |  - |  - |  - |
 * |       9 |     9 |      11 |   tab |  + |  - |  + |  + |  - |  - |  - |
 * |   10-13 |   A-D |   12-15 |    ws |  + |  - |  + |  - |  - |  - |  - |
 * |   14-31 |  E-1F |   16-37 |   cc2 |  + |  - |  - |  - |  - |  - |  - |
 * |      32 |    20 |      40 |   spc |  - |  + |  + |  + |  - |  - |  - |
 * |   33-47 | 21-2F |   41-57 |   pn1 |  - |  + |  - |  - |  + |  + |  - |
 * |   48-57 | 30-39 |   60-71 |   num |  - |  + |  - |  - |  + |  - |  + |
 * |   58-64 | 3A-40 |  72-100 |   pn2 |  - |  + |  - |  - |  + |  + |  - |
 * |   65-70 | 41-46 | 101-106 |   ulx |  - |  + |  - |  - |  + |  - |  + |
 * |   71-90 | 47-5A | 107-132 |    ul |  - |  + |  - |  - |  + |  - |  + |
 * |   91-96 | 5B-60 | 133-140 |   pn3 |  - |  + |  - |  - |  + |  + |  - |
 * |  97-102 | 61-66 | 141-146 |   llx |  - |  + |  - |  - |  + |  - |  + |
 * | 103-122 | 67-7A | 147-172 |    ll |  - |  + |  - |  - |  + |  + |  + |
 * | 123-126 | 7B-7E | 173-176 |   pn4 |  - |  + |  - |  - |  + |  - |  - |
 * |     127 |    7F |     177 |    bs |  + |  - |  - |  - |  - |  - |  - |
 * +----------------------------------------------------------------------+
 *
 * fig. 2:
 * +-----------------------------------------------------------+
 * |           ASCII           |       |    |    |    |    |    |
 * |---------------------------| Chars | al | up | lo | dg | xd |
 * |   dec   |  hex  |   oct   |       |    |    |    |    |    |
 * |---------+-------+---------+-------+----+----+----+----+----|
 * |     0-8 |   0-8 |    0-10 |   cc1 |  - |  - |  - |  - |  - |
 * |       9 |     9 |      11 |   tab |  - |  - |  - |  - |  - |
 * |   10-13 |   A-D |   12-15 |    ws |  - |  - |  - |  - |  - |
 * |   14-31 |  E-1F |   16-37 |   cc2 |  - |  - |  - |  - |  - |
 * |      32 |    20 |      40 |   spc |  - |  - |  - |  - |  - |
 * |   33-47 | 21-2F |   41-57 |   pn1 |  - |  - |  - |  - |  - |
 * |   48-57 | 30-39 |   60-71 |   num |  - |  - |  - |  + |  + |
 * |   58-64 | 3A-40 |  72-100 |   pn2 |  - |  - |  - |  - |  - |
 * |   65-70 | 41-46 | 101-106 |   ulx |  + |  + |  - |  - |  + |
 * |   71-90 | 47-5A | 107-132 |    ul |  + |  + |  - |  - |  - |
 * |   91-96 | 5B-60 | 133-140 |   pn3 |  - |  - |  - |  - |  - |
 * |  97-102 | 61-66 | 141-146 |   llx |  + |  - |  + |  - |  + |
 * | 103-122 | 67-7A | 147-172 |    ll |  + |  - |  + |  - |  - |
 * | 123-126 | 7B-7E | 173-176 |   pn4 |  - |  - |  - |  - |  - |
 * |     127 |    7F |     177 |    bs |  - |  - |  - |  - |  - |
 * +-----------------------------------------------------------+
 *
 * Mapping (bits):
 * 1st  -> iscntrl
 * 2nd  -> isprint
 * 3rd  -> isspace
 * 4th  -> isblank
 * 5th  -> isgraph
 * 6th  -> ispunct
 * 7th  -> isalnum
 * 8th  -> isalpha
 * 9th  -> isupper
 * 10th -> islower
 * 11th -> isdigit
 * 12th -> isxdigit
 */
const unsigned short SYMBOL_TABLE[256] = {
  // control codes 1
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  // tab
  0b0000000000001101,
  // whitespaces
  0b0000000000000101, 0b0000000000000101, 0b0000000000000101,
  0b0000000000000101,
  // control codes 2
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  0b0000000000000001, 0b0000000000000001, 0b0000000000000001,
  // scape
  0b0000000000001110,
  // punct 1
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  // numbers
  0b0000110001010010, 0b0000110001010010, 0b0000110001010010,
  0b0000110001010010, 0b0000110001010010, 0b0000110001010010,
  0b0000110001010010, 0b0000110001010010, 0b0000110001010010,
  0b0000110001010010,
  // punct 2
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010,
  // uppercase letters (hex flagged)
  0b0000100111010010, 0b0000100111010010, 0b0000100111010010,
  0b0000100111010010, 0b0000100111010010, 0b0000100111010010,
  // uppercase letters
  0b0000000111010010, 0b0000000111010010, 0b0000000111010010,
  0b0000000111010010, 0b0000000111010010, 0b0000000111010010,
  0b0000000111010010, 0b0000000111010010, 0b0000000111010010,
  0b0000000111010010, 0b0000000111010010, 0b0000000111010010,
  0b0000000111010010, 0b0000000111010010, 0b0000000111010010,
  0b0000000111010010, 0b0000000111010010, 0b0000000111010010,
  0b0000000111010010, 0b0000000111010010,
  // punct 3
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  // lowercase letters (hex flagged)
  0b0000101011010010, 0b0000101011010010, 0b0000101011010010,
  0b0000101011010010, 0b0000101011010010, 0b0000101011010010,
  // lowercase letters
  0b0000001011010010, 0b0000001011010010, 0b0000001011010010,
  0b0000001011010010, 0b0000001011010010, 0b0000001011010010,
  0b0000001011010010, 0b0000001011010010, 0b0000001011010010,
  0b0000001011010010, 0b0000001011010010, 0b0000001011010010,
  0b0000001011010010, 0b0000001011010010, 0b0000001011010010,
  0b0000001011010010, 0b0000001011010010, 0b0000001011010010,
  0b0000001011010010, 0b0000001011010010,
  // punct 4
  0b0000000000110010, 0b0000000000110010, 0b0000000000110010,
  0b0000000000110010,
  // backspace
  0b0000000000000001,

  // empty (for safe)
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000, 0b0000000000000000,
  0b0000000000000000, 0b0000000000000000
};

int
__kisalnum (char c)
{
  return SYMBOL_TABLE[c] & (1 << 6);
}

int
__kisalpha (char c)
{
  return SYMBOL_TABLE[c] & (1 << 7);
}

int
__kisblank (char c)
{
  return SYMBOL_TABLE[c] & (1 << 3);
}

int
__kiscntrl (char c)
{
  return SYMBOL_TABLE[c] & 1;
}

int
__kisdigit (char c)
{
  return SYMBOL_TABLE[c] & (1 << 10);
}

int
__kisgraph (char c)
{
  return SYMBOL_TABLE[c] & (1 << 4);
}

int
__kislower (char c)
{
  return SYMBOL_TABLE[c] & (1 << 9);
}

int
__kisprint (char c)
{
  return SYMBOL_TABLE[c] & (1 << 1);
}

int
__kispunct (char c)
{
  return SYMBOL_TABLE[c] & (1 << 5);
}

int
__kisspace (char c)
{
  return SYMBOL_TABLE[c] & (1 << 2);
}

int
__kisupper (char c)
{
  return SYMBOL_TABLE[c] & (1 << 8);
}

int
__kisxdigit (char c)
{
  return SYMBOL_TABLE[c] & (1 << 11);
}

char
__ktoupper (char c)
{
  return __kisalpha (c) > 0 ? c & ~0x20 : c;
}

char
__ktolower (char c)
{
  return __kisalpha (c) > 0 ? c | 0x20 : c;
}

char
__ktoggle (char c)
{
  return __kisalpha (c) > 0 ? c ^ 0x20 : c;
}
